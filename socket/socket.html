<script type="text/html" settings>
<div class="padding npb">
	<div class="m" data-jc="dropdown" data-jc-path="id" data-jc-config="datasource:common.instances;empty:;required:true;condition:n => n.component === 'flowboardsocket'">@(Flow instance)</div>
</div>
</script>

<script type="text/html" body>
	<div class="click"><i class="fa fa-plug"></i></div>
</script>

<style>
	.fb-socket .click { width: 24px; height: 24px; border-radius: 3px; cursor: pointer; background-color: #E33733; color: white; text-align: center; font-size: 16px; }
	.fb-socket .on { background-position: 0 0; background-color: #8CC152; }
</style>

<script>
exports.name = 'socket';
exports.title = 'Socket';
exports.icon = 'plug';
exports.author = 'Peter Å irka';
exports.group = 'Common';
exports.options = { id: null };
exports.version = '1.0.0';
exports.install = function(instance) {

	var state = 0;

	instance.element.addClass('fb-socket');
	instance.on('data', function(response) {
		if (response.id === instance.options.id && response.type === 'laststate') {
			state = response.body;
			instance.switch();
		}
	});

	instance.on('options', function(options) {
		options.id && instance.send(options.id, 'laststate');
	});

	instance.switch = function() {
		instance.options.id && instance.find('.click').toggleClass('on', state === 1);
	};

	instance.event('click touchend', '.click', function() {
		!common.draft && instance.options.id && instance.send(instance.options.id, 'switch', { value: state ? 0 : 1 });
	});

	instance.make = function() {
		instance.emit('options', instance.options);
	};
};
</script>